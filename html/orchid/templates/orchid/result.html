{% extends "orchid/base_layout.html" %}

{% block title %}Photo Identity | OrchiD{% endblock %}

{% block content %}
<h2>Photo Identity</h2>

<p>
    <div id="identity"></div>
</p>

<p>
    <img src="{{ photo.photo.url }}" id="photo" class="img-responsive img-rounded" alt="Photo">
</p>
{% endblock %}

{% block scripts %}
<script>
jQuery(function( $ ) {
    var jcrop_api;
    var roi;

    // Load the photo identities.
    $("#identity").html('<div class="alert alert-info" role="alert"><i class="fa fa-gear fa-fw"></i> Please wait while we identify your photo...</div>');
    $.ajax({
        url: "{% url 'orchid:identify' photo.id %}",
        dataType: "html"
    }).done(function(data) {
        // Display the result.
        $("#identity").html(data);

        // Initialize Bootstrap Popovers.
        $("a[data-toggle='popover']")
            .popover({html: true, trigger: 'focus'})
            .click(function(event) {
                // Force focus so that the 'focus' event is triggered.
                $(this).focus();
                return false;
            });
    });

    {% if roi %}
    // Display the ROI on the photo if any.
    $('#photo').Jcrop({
            trueSize: [{{ photo.photo.width }}, {{ photo.photo.height }}]
        },
        function() {
            jcrop_api = this;
        }
    );
    jcrop_api.setSelect([{{roi.x}},{{roi.y}},{{roi.x2}},{{roi.y2}}]);
    {% endif %}
});
</script>
{% endblock %}
