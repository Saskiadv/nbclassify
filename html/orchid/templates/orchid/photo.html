{% extends "orchid/base_layout.html" %}

{% block title %}Identify Photo | OrchiD{% endblock %}

{% block content %}
<h2>Identify Photo</h2>

<p>Select the flower in the photo below. Make sure there's only one flower
in the selection and keep at least a 10 pixel border around the flower's
contours. Then click "Identify Photo" to identify the flower.</p>

<form action="{% url 'orchid:identify' photo.id %}" method="post" id="identify_form">
    {% csrf_token %}
    <input type="hidden" id="cropped" name="cropped" value="">
    <button type="submit" class="pure-button pure-button-primary nbc"><i class="fa fa-search fa-fw"></i> Identify Photo</button>
</form>

<p>
    <div id="identity"></div>
</p>

<p>
    <img src="{{ photo.photo.url }}" id="photo" class="img-responsive img-rounded" alt="Photo">
</p>
{% endblock %}

{% block scripts %}
<script>
jQuery(function( $ ) {
    // Initialize Jcrop.
    $('#photo').Jcrop({
        onSelect: setCoords,
        onRelease: clearCoords
    });

    /* Set the Jcrop coordinates in the form. */
    function setCoords(c) {
        $('#cropped').val(c.y+':'+c.y2+','+c.x+':'+c.x2);
    };

    /* Clear the Jcrop coordinates in the form. */
    function clearCoords() {
        $('#cropped').val('');
    };

    // Identify Photo button.
    $('#identify_form button').click(function(event) {
        $("#identity").html('<div class="alert alert-info" role="alert"><i class="fa fa-gear fa-fw"></i> Please wait while we identify your photo...</div>');

        $("#identify_form").ajaxForm({
            target: '#identity',
            success: function() {
                // Initialize Bootstrap Popovers.
                $("a[data-toggle='popover']")
                    .popover({html: true, trigger: 'focus'})
                    .click(function(event) {
                        return false;
                    });
            }
        }).submit();

        // Prevent normal browser submit and page navigation.
        return false;
    });
});
</script>
{% endblock %}
